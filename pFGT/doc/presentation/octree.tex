
\begin{frame}
\frametitle{Expansion or Truncation?}
\begin{itemize}
\item Many sources per FGT box $-$ Expansion
\newline
\item Few sources per FGT box $-$ Truncation
\newline
\item Non-uniform distributions $-$ Hybrid
\end{itemize}
\end{frame}


\begin{frame}
\frametitle{Octree based FGT}
\framesubtitle{Tree construction}
\begin{columns}[T]
\begin{column}{0.4\textwidth}
\begin{itemize}
\item Max. of $m$ points per leaf
\only<2->{
\item Higher point density $\Rightarrow$ finer leaves
}
\only<3>{
\item Large leaves $\Rightarrow$ Truncation ({\color{blue}{Direct}})
\item Small leaves $\Rightarrow$ Expansion ({\color{green!65!black}{Expand}})
}
\end{itemize}
\end{column}
\begin{column}{0.6\textwidth}
\only<1> {
\input{pointsDemoIn}
}
\only<2> {
\input{pointsDemoOut}
}
\only<3> {
\input{markedOctree}
}
\end{column}
\end{columns}
\end{frame}


\begin{frame}
\frametitle{Octree based FGT}
\framesubtitle{Flow of Information}
\begin{itemize}
\item Source $-$ $y$
\item Target $-$ $x$
\item {\color{blue}{Direct}} tree $-$ {\color{blue}{$T_d$}}
\item {\color{green!65!black}{Expand}} tree $-$ {\color{green!65!black}{$T_e$}}
\end{itemize}

\vspace{-0.25cm}

\only<1> {
\bean
y & x &  \\
{\color{green!65!black}{T_e}} & {\color{green!65!black}{T_e}} & {\color{green!65!black}{y}} \xrightarrow[]{\textbf{S2W}} \{ w_k\} \xrightarrow[]{\textbf{W2L}} \{ v_k \}\xrightarrow[]{\textbf{L2T}} {\color{green!65!black}{x}}  \\
{\color{green!65!black}{T_e}} & {\color{blue}{T_d}} & {\color{green!65!black}{y}} \xrightarrow[]{\textbf{S2W}} \{ w_k\} \xrightarrow[]{\textbf{W2D}} {\color{blue}{x}}  \\
{\color{blue}{T_d}} & {\color{green!65!black}{T_e}} & {\color{blue}{y}} \xrightarrow[]{\textbf{D2L}} \{ v_k \}\xrightarrow[]{\textbf{L2T}} {\color{green!65!black}{x}}  \\
{\color{blue}{T_d}} & {\color{blue}{T_d}} & {\color{blue}{y}} \xrightarrow[]{\textbf{D2D}} {\color{blue}{x}}  \\
\eean
}

\only<2> {
\bean
y & x &  \\
{\color{green!65!black}{T_e}} & {\color{green!65!black}{T_e}} & {\color{green!65!black}{y}} \xrightarrow[]{\textbf{S2W}} \{ w_k\} \xrightarrow[]{\textbf{W2L}} \{ v_k \}\xrightarrow[]{\textbf{L2T}} {\color{green!65!black}{x}}  \\
{\color{green!65!black}{T_e}} & {\color{blue}{T_d}} & {\color{green!65!black}{y}} \xrightarrow[]{\textbf{S2W}} \{ w_k\} \xrightarrow[]{\color{red}{\textbf{W2D}}} {\color{blue}{x}} \, \color{red}{\left[ F(x) \, +=\, \sum_{|k| \leq p} \hat{G}(k)  w_k e^{i \lambda k \cdot (x - c^B)} \right]} \\
{\color{blue}{T_d}} & {\color{green!65!black}{T_e}} & {\color{blue}{y}} \xrightarrow[]{\textbf{D2L}} \{ v_k \}\xrightarrow[]{\textbf{L2T}} {\color{green!65!black}{x}}  \\
{\color{blue}{T_d}} & {\color{blue}{T_d}} & {\color{blue}{y}} \xrightarrow[]{\textbf{D2D}} {\color{blue}{x}}  \\
\eean
}

\only<3> {
\bean
y & x &  \\
{\color{green!65!black}{T_e}} & {\color{green!65!black}{T_e}} & {\color{green!65!black}{y}} \xrightarrow[]{\textbf{S2W}} \{ w_k\} \xrightarrow[]{\textbf{W2L}} \{ v_k \}\xrightarrow[]{\textbf{L2T}} {\color{green!65!black}{x}}  \\
{\color{green!65!black}{T_e}} & {\color{blue}{T_d}} & {\color{green!65!black}{y}} \xrightarrow[]{\textbf{S2W}} \{ w_k\} \xrightarrow[]{\color{red}{\textbf{W2D}}} {\color{blue}{x}} \, \color{red}{\left[ F(x) \, +=\, \sum_{|k| \leq p} \hat{G}(k)  w_k e^{i \lambda k \cdot (x - c^B)} \right]} \\
{\color{blue}{T_d}} & {\color{green!65!black}{T_e}} & {\color{blue}{y}} \xrightarrow[]{\color{red}{\textbf{D2L}}} \{ v_k \}\xrightarrow[]{\textbf{L2T}} {\color{green!65!black}{x}} \, \color{red}{\left[ v_k  \,+=\, \, f(y) e^{i \lambda k \cdot (c^D - y)} \right]} \\
{\color{blue}{T_d}} & {\color{blue}{T_d}} & {\color{blue}{y}} \xrightarrow[]{\textbf{D2D}} {\color{blue}{x}}  \\
\eean
}

\only<4> {
\bean
y & x &  \\
{\color{green!65!black}{T_e}} & {\color{green!65!black}{T_e}} & {\color{green!65!black}{y}} \xrightarrow[]{\textbf{S2W}} \{ w_k\} \xrightarrow[]{\textbf{W2L}} \{ v_k \}\xrightarrow[]{\textbf{L2T}} {\color{green!65!black}{x}}  \\
{\color{green!65!black}{T_e}} & {\color{blue}{T_d}} & {\color{green!65!black}{y}} \xrightarrow[]{\textbf{S2W}} \{ w_k\} \xrightarrow[]{\color{red}{\textbf{W2D}}} {\color{blue}{x}} \, \color{red}{\left[ F(x) \, +=\, \sum_{|k| \leq p} \hat{G}(k)  w_k e^{i \lambda k \cdot (x - c^B)} \right]} \\
{\color{blue}{T_d}} & {\color{green!65!black}{T_e}} & {\color{blue}{y}} \xrightarrow[]{\color{red}{\textbf{D2L}}} \{ v_k \}\xrightarrow[]{\textbf{L2T}} {\color{green!65!black}{x}} \, \color{red}{\left[ v_k  \,+=\, \, f(y) e^{i \lambda k \cdot (c^D - y)} \right]} \\
{\color{blue}{T_d}} & {\color{blue}{T_d}} & {\color{blue}{y}} \xrightarrow[]{\color{red}{\textbf{D2D}}} {\color{blue}{x}} \, \color{red}{\left[ F(x) \,+=\, G_\delta(\norm{x - y}) f(y) \right]}  \\
\eean
}

\end{frame}

\begin{frame}
\frametitle{Octree based FGT}
\framesubtitle{Data Partition}
\begin{columns}[T]
\begin{column}{0.6\textwidth}
\begin{itemize}
\item Distributed regular grid of FGT boxes
\begin{itemize}
\item Each box owned by an unique CPU
\item Each CPU owns a sub-grid of boxes
\item PETSc package
\end{itemize}
\item Distributed octree
\begin{itemize}
\item Each leaf owned by an unique CPU
\item Sorted in Morton (space-filling) order
\item {\color{red!40!black}{Direct}} and Expand trees partitioned independently
\item Dendro package 
\end{itemize}
\item Distributed points $-$ mapped to enclosing leaf
\end{itemize}
\end{column}
\begin{column}{0.4\textwidth}
\input{gridPartition}
\newline
\input{expandDirectPartition}
\end{column}
\end{columns}
\end{frame}

\begin{frame}
\frametitle{Octree based FGT}
\framesubtitle{Parallel Algorithm}
\begin{enumerate}
\item<1-> S2W 
\only<1>{
\begin{enumerate}[(A)]
\item CPUs containing {\color{green!65!black}{Expand}} sources compute plane wave expansions
\item Send expansions to owners of respective FGT boxes
\item Add received values to existing plane wave expansions
\end{enumerate}
}
\item<2-> W2D
\only<2>{
\begin{enumerate}[(A)]
\item CPUs containing {\color{blue}{Direct}} targets form a list of {\em{relevant}} FGT boxes
\item Request plane wave expansions for these boxes from their owners
\item Update transform at {\color{blue}{Direct}} targets using received values
\end{enumerate}
}
\item<3-> D2D
\only<3>{
\begin{enumerate}[(A)]
\item Send {\color{blue}{Direct}} sources to CPUs containing {\em{relevant}} {\color{blue}{Direct}} leaves
\item Update transform at {\color{blue}{Direct}} targets using received values
\end{enumerate}
}
\item<4-> W2L
\only<4>{
\begin{enumerate}[(A)]
\item Communicate plane wave expansions of {\em{ghost}} FGT boxes
\item Execute translation/sweeping algorithm
\end{enumerate}
}
\item<5-> D2L
\only<5>{
\begin{enumerate}[(A)]
\item CPUs containing {\color{blue}{Direct}} sources compute their contributions to {\em{relevant}} FGT boxes
\item Send these contributions to owners of respective FGT boxes
\item Update local expansions using received values 
\end{enumerate}
}
\item<6> L2T
\only<6>{
\begin{enumerate}[(A)]
\item Send local expansions to CPUs containing {\em{relevant}} {\color{green!65!black}{Expand}} targets
\item Compute transform at {\color{green!65!black}{Expand}} targets using received values
\end{enumerate}
}
\end{enumerate}
\end{frame}
